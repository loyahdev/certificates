<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8"> <!-- Make sure it's mobile-friendly -->
    <title>Certificate Files</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            color: black; /* General text red */
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: left;
            background-color: #d3d3d3; /* Grey background */
            color: red; /* Text color red */
        }
        th {
            background-color: #a9a9a9; /* Darker grey for header */
        }
        a {
            text-decoration: none;
            color: red; /* Links red */
        }
        a:hover {
            text-decoration: underline;
        }
        .date {
            color: black; /* Date text black */
        }
        @media (max-width: 600px) {
            body {
                padding: 5px;
                font-size: 16px; /* Larger text for mobile */
            }
            th, td {
                padding: 12px; /* Larger padding for table cells */
            }
        }
    </style>
     <script>
    document.addEventListener('DOMContentLoaded', function() {
    fetchRepoFiles('loyahdev', 'certificates', 'certs');
});

const rootPath = 'certs'; // Define the root path

async function fetchRepoFiles(owner, repo, path) {
    // Fetch the contents from GitHub API
    const apiURL = path ? `https://api.github.com/repos/${owner}/${repo}/contents/${path}` : `https://api.github.com/repos/${owner}/${repo}/contents`;
    try {
        const response = await fetch(apiURL);
        const data = await response.json();
        if (response.ok) {
            updateFileList(data, owner, repo, path);
        } else {
            console.error('Error fetching files:', data.message);
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

async function fetchLastCommitDate(owner, repo, filePath) {
        const commitsURL = `https://api.github.com/repos/${owner}/${repo}/commits?path=${filePath}`;
        try {
            const response = await fetch(commitsURL);
            const commits = await response.json();
            if (response.ok && commits.length > 0) {
                return new Date(commits[0].commit.committer.date).toLocaleDateString();
            } else {
                console.error('Error fetching commits:', commits.message);
                return 'Unknown';
            }
        } catch (error) {
            console.error('Error:', error);
            return 'Unknown';
        }
    }

async function updateFileList(items, owner, repo, path) {
    const table = document.querySelector('table');
    Array.from(table.rows).slice(1).forEach(row => row.remove());

    // Add 'Go Back' link if not in root directory and path is not empty
    if (path && path !== rootPath) {
        const parentPath = path.split('/').slice(0, -1).join('/');
        const backRow = document.createElement('tr');
        backRow.innerHTML = `
            <td><a href="#" onclick="event.preventDefault(); fetchRepoFiles('${owner}', '${repo}', '${parentPath}');">/</a></td>
            <td></td>
            <td></td>
        `;
        table.appendChild(backRow);
    }

    for (const item of items) {
        let lastCommitDate = 'Unknown';
        let sizeDisplay = '';
        let clickHandler = '';

        if (item.type === 'file') {
            lastCommitDate = await fetchLastCommitDate(owner, repo, item.path);
            sizeDisplay = formatBytes(item.size);
            clickHandler = `href="${item.download_url}" target="_blank"`;
        } else if (item.type === 'dir') {
            clickHandler = `href="#" onclick="event.preventDefault(); fetchRepoFiles('${owner}', '${repo}', '${item.path}');"`
            sizeDisplay = 'Directory';
            lastCommitDate = '';
        }

        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><a ${clickHandler}>${item.name}</a></td>
            <td>${sizeDisplay}</td>
            <td class="date">${lastCommitDate}</td>
        `;
        table.appendChild(tr);
    }
}

        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

        // Add this inside your <script> tag but outside of any function
function directoryClicked(owner, repo, path) {
    event.preventDefault(); // Prevent the default anchor action
    fetchRepoFiles(owner, repo, path); // Fetch the contents of the directory
}

        // Handle browser navigation events
window.onpopstate = function(event) {
    if (event.state && event.state.path) {
        // Extract the owner and repo name from the path
        const owner = 'loyahdev';
        const repo = 'certificates';
        const path = event.state.path.replace('/certs/', '');
        fetchRepoFiles(owner, repo, path);
    }
};
    </script>
</head>
<body>
    <h1>iOS Certificates</h1>
    <table>
        <tr><th>File Name</th><th>File Size</th><th>Date</th></tr>
        <!-- Repeat this block for each file -->
        <tr>
            <td><a href="Loading...">Loading...</a></td>
            <td>0KB</td>
            <td class="date">Loading...</td>
        </tr>
        <!-- ... other files ... -->
    </table>
</body>
</html>
