<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8"> <!-- Make sure it's mobile-friendly -->
    <title>Simple File List</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            color: red; /* General text red */
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: left;
            background-color: #d3d3d3; /* Grey background */
            color: red; /* Text color red */
        }
        th {
            background-color: #a9a9a9; /* Darker grey for header */
        }
        a {
            text-decoration: none;
            color: red; /* Links red */
        }
        a:hover {
            text-decoration: underline;
        }
        .date {
            color: black; /* Date text black */
        }
        @media (max-width: 600px) {
            body {
                padding: 5px;
                font-size: 16px; /* Larger text for mobile */
            }
            th, td {
                padding: 12px; /* Larger padding for table cells */
            }
        }
    </style>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
    fetchRepoFiles('loyahdev', 'certificates', '');
});

async function fetchRepoFiles(owner, repo, path) {
    // Update the URL in the address bar to include the base domain and repository
    const baseDomain = 'https://loyahdev.me';
    const newPath = baseDomain + '/certificates/' + path;
    history.pushState({ path: path }, '', newPath);

    // Handle the case where the path is empty (root of the repo)
    const apiPath = path ? `/${path}` : '';
    const apiURL = `https://api.github.com/repos/${owner}/${repo}/contents${apiPath}`;
        try {
            const response = await fetch(apiURL);
            const data = await response.json();
            if (response.ok) {
                updateFileList(data, owner, repo);
            } else {
                console.error('Error fetching files:', data.message);
            }
        } catch (error) {
            console.error('Error:', error);
        }
    }

    async function fetchLastCommitDate(owner, repo, filePath) {
        const commitsURL = `https://api.github.com/repos/${owner}/${repo}/commits?path=${filePath}`;
        try {
            const response = await fetch(commitsURL);
            const commits = await response.json();
            if (response.ok && commits.length > 0) {
                return new Date(commits[0].commit.committer.date).toLocaleDateString();
            } else {
                console.error('Error fetching commits:', commits.message);
                return 'Unknown';
            }
        } catch (error) {
            console.error('Error:', error);
            return 'Unknown';
        }
    }

    async function updateFileList(items, owner, repo, path) {
    const table = document.querySelector('table');
    // Clear existing rows (except header)
    Array.from(table.rows).slice(1).forEach(row => row.remove());

    for (const item of items) {
        let lastCommitDate = 'Unknown';
        let sizeDisplay = '';
        let clickHandler = '';

        if (item.type === 'file') {
            lastCommitDate = await fetchLastCommitDate(owner, repo, item.path);
            sizeDisplay = formatBytes(item.size);
        } else if (item.type === 'dir') {
            // Add a click event handler to directories
            tr.querySelector('a').addEventListener('click', function(event) {
                event.preventDefault();
                fetchRepoFiles(owner, repo, item.path);
            });
        }

        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><a href="#" ${clickHandler}>${item.name}</a></td>
            <td>${sizeDisplay}</td>
            <td class="date">${lastCommitDate}</td>
        `;
        table.appendChild(tr);
    }
}

        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

        // Add this inside your <script> tag but outside of any function
function directoryClicked(owner, repo, path) {
    event.preventDefault(); // Prevent the default anchor action
    fetchRepoFiles(owner, repo, path); // Fetch the contents of the directory
}

        // Handle back/forward browser navigation
window.onpopstate = function(event) {
    if (event.state && event.state.path) {
        const path = 'repoName' + event.state.path;
        fetchRepoFiles('ownerName', 'repoName', path);
    }
};

document.addEventListener('DOMContentLoaded', function() {
    // Replace 'ownerName', 'repoName', and 'initialPath' with actual values
    fetchRepoFiles('loyahdev', 'certificates', 'certificates');
});

    </script>
</head>
<body>
    <h1>Index of /files</h1>
    <table>
        <tr><th>File Name</th><th>File Size</th><th>Date</th></tr>
        <!-- Repeat this block for each file -->
        <tr>
            <td><a href="link_to_file_1">file_1.zip</a></td>
            <td>1.2M</td>
            <td class="date">2023-Mar-01 12:00</td>
        </tr>
        <!-- ... other files ... -->
    </table>
</body>
</html>
